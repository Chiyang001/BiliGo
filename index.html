<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>BiliGo - B站私信自动回复系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 提示消息 -->
    <div id="toast-container"></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <h1>BiliGo</h1>
            </div>
            <div class="status-indicator">
                <i class="bi bi-circle-fill status-icon"></i>
                <span id="status">未启动</span>
            </div>
        </header>

        <div class="main-content">
            <section class="control-panel">
                <h2><i class="bi bi-sliders"></i> 系统控制</h2>
                <div class="button-group">
                    <button id="start-btn" class="btn-primary" onclick="startMonitoring()">
                        <i class="bi bi-play-fill"></i> 开始监控
                    </button>
                    <button id="stop-btn" class="btn-danger" onclick="stopMonitoring()" disabled>
                        <i class="bi bi-stop-fill"></i> 停止监控
                    </button>
                </div>
            </section>

            <section class="config-panel">
                <h2><i class="bi bi-gear-fill"></i> 登录配置</h2>
                <div class="form-row">
                    <label for="sessdata">SESSDATA:</label>
                    <div class="input-wrapper">
                        <i class="bi bi-key-fill"></i>
                        <input type="password" id="sessdata" placeholder="请输入B站SESSDATA">
                    </div>
                </div>
                <div class="form-row">
                    <label for="bili_jct">bili_jct:</label>
                    <div class="input-wrapper">
                        <i class="bi bi-shield-lock-fill"></i>
                        <input type="password" id="bili_jct" placeholder="请输入bili_jct">
                    </div>
                </div>
                <button class="btn-primary" onclick="saveConfig()">
                    <i class="bi bi-save-fill"></i> 保存配置
                </button>
            </section>

            <section class="default-reply-panel">
                <h2><i class="bi bi-chat-dots-fill"></i> 默认回复设置</h2>
                <div class="form-row">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="default-reply-enabled">
                        <label for="default-reply-enabled">启用默认回复</label>
                    </div>
                    <p class="help-text">当用户消息未匹配任何关键词时，自动回复默认消息</p>
                </div>
                
                <div class="form-row">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="reply-history-messages">
                        <label for="reply-history-messages">回复历史消息</label>
                    </div>
                    <p class="help-text">开启后会检查并回复历史消息；关闭后只回复监控启动后的新消息</p>
                </div>
                
                <div class="form-row">
                    <label>回复类型:</label>
                    <div class="radio-group">
                        <div class="radio-wrapper">
                            <input type="radio" id="default-reply-text" name="default-reply-type" value="text" checked>
                            <label for="default-reply-text">文字回复</label>
                        </div>
                        <div class="radio-wrapper">
                            <input type="radio" id="default-reply-image" name="default-reply-type" value="image">
                            <label for="default-reply-image">图片回复</label>
                        </div>
                    </div>
                </div>
                
                <div id="default-text-content" class="form-row">
                    <label for="default-reply-message">默认回复内容:</label>
                    <textarea id="default-reply-message" placeholder="请输入默认回复内容，例如：您好，我现在不在，稍后会回复您的消息。"></textarea>
                </div>
                
                <div id="default-image-content" class="form-row" style="display: none;">
                    <label for="default-reply-image-path">选择图片:</label>
                    <div class="image-selector">
                        <input type="text" id="default-reply-image-path" placeholder="请选择图片文件" readonly>
                        <button type="button" class="btn-secondary" onclick="openImageBrowser('default')">
                            <i class="bi bi-folder2-open"></i> 选择图片
                        </button>
                    </div>
                    <div id="default-image-preview" class="image-preview" style="display: none;"></div>
                </div>
                
                <button class="btn-primary" onclick="saveDefaultReply()">
                    <i class="bi bi-save-fill"></i> 保存默认回复设置
                </button>
            </section>


            <section class="keyword-panel">
                <h2><i class="bi bi-chat-square-text-fill"></i> 关键词回复设置</h2>
                <div class="form-row">
                    <label for="rule-title">规则标题:</label>
                    <div class="input-wrapper">
                        <i class="bi bi-tag-fill"></i>
                        <input type="text" id="rule-title" placeholder="例如：问候回复、帮助说明">
                    </div>
                </div>
                <div class="form-row">
                    <label for="keywords">关键词 (用中文逗号分隔):</label>
                    <div class="input-wrapper">
                        <i class="bi bi-hash"></i>
                        <input type="text" id="keywords" placeholder="例如：你好，帮助，问题">
                    </div>
                </div>
                
                <div class="form-row">
                    <label>回复类型:</label>
                    <div class="radio-group">
                        <div class="radio-wrapper">
                            <input type="radio" id="rule-reply-text" name="rule-reply-type" value="text" checked>
                            <label for="rule-reply-text">文字回复</label>
                        </div>
                        <div class="radio-wrapper">
                            <input type="radio" id="rule-reply-image" name="rule-reply-type" value="image">
                            <label for="rule-reply-image">图片回复</label>
                        </div>
                    </div>
                </div>
                
                <div id="rule-text-content" class="form-row">
                    <label for="reply">回复内容:</label>
                    <textarea id="reply" placeholder="请输入回复内容"></textarea>
                </div>
                
                <div id="rule-image-content" class="form-row" style="display: none;">
                    <label for="rule-reply-image-path">选择图片:</label>
                    <div class="image-selector">
                        <input type="text" id="rule-reply-image-path" placeholder="请选择图片文件" readonly>
                        <button type="button" class="btn-secondary" onclick="openImageBrowser('rule')">
                            <i class="bi bi-folder2-open"></i> 选择图片
                        </button>
                    </div>
                    <div id="rule-image-preview" class="image-preview" style="display: none;"></div>
                </div>
                
                <button class="btn-primary" onclick="addRule()">
                    <i class="bi bi-plus-circle-fill"></i> 添加规则
                </button>
            </section>

            <section class="rules-panel">
                <h2><i class="bi bi-list-check"></i> 回复规则列表</h2>
                <div class="pagination">
                    <button id="prev-page" class="btn-icon" onclick="changePage(-1)" disabled>
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <span id="page-info">第 1 页，共 1 页</span>
                    <button id="next-page" class="btn-icon" onclick="changePage(1)" disabled>
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                <div id="rules-list" class="rules-list"></div>
                <div class="pagination">
                    <button id="prev-page-bottom" class="btn-icon" onclick="changePage(-1)" disabled>
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <span id="page-info-bottom">第 1 页，共 1 页</span>
                    <button id="next-page-bottom" class="btn-icon" onclick="changePage(1)" disabled>
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </section>

            <section class="log-panel">
                <h2><i class="bi bi-journal-text"></i> 系统日志</h2>
                <div id="log-container">
                    <div id="log"></div>
                </div>
            </section>
        </div>

        <footer>
            <p>© 2025 <a href="https://space.bilibili.com/404891612" target="_blank">炽阳001</a> | BiliGo 自动回复系统</p>
        </footer>
    </div>

    <!-- 图片浏览器模态框 -->
    <div id="image-browser-modal" class="modal">
        <div class="modal-content image-browser-content">
            <div class="modal-header">
                <h3><i class="bi bi-folder2-open"></i> 选择图片</h3>
                <button class="close-btn" onclick="closeImageBrowser()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="browser-toolbar">
                    <div class="current-path">
                        <i class="bi bi-folder-fill"></i>
                        <span id="current-path-text">加载中...</span>
                    </div>
                    <div class="quick-nav">
                        <button class="btn-secondary btn-sm" onclick="goToHomeDirectory()">
                            <i class="bi bi-house-fill"></i> 主目录
                        </button>
                    </div>
                </div>
                <div id="file-list" class="file-list">
                    <div class="loading">
                        <i class="bi bi-arrow-clockwise spin"></i> 加载中...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeImageBrowser()">
                    <i class="bi bi-x"></i> 取消
                </button>
            </div>
        </div>
    </div>

    <!-- 编辑规则模态框 -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="bi bi-pencil-square"></i> 编辑规则</h3>
                <button class="close-btn" onclick="closeEditModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <label for="edit-rule-title">规则标题:</label>
                    <div class="input-wrapper">
                        <i class="bi bi-tag-fill"></i>
                        <input type="text" id="edit-rule-title" placeholder="例如：问候回复、帮助说明">
                    </div>
                </div>
                <div class="form-row">
                    <label for="edit-keywords">关键词 (用中文逗号分隔):</label>
                    <div class="input-wrapper">
                        <i class="bi bi-hash"></i>
                        <input type="text" id="edit-keywords" placeholder="例如：你好，帮助，问题">
                    </div>
                </div>
                
                <div class="form-row">
                    <label>回复类型:</label>
                    <div class="radio-group">
                        <div class="radio-wrapper">
                            <input type="radio" id="edit-reply-text" name="edit-reply-type" value="text" checked>
                            <label for="edit-reply-text">文字回复</label>
                        </div>
                        <div class="radio-wrapper">
                            <input type="radio" id="edit-reply-image" name="edit-reply-type" value="image">
                            <label for="edit-reply-image">图片回复</label>
                        </div>
                    </div>
                </div>
                
                <div id="edit-text-content" class="form-row">
                    <label for="edit-reply">回复内容:</label>
                    <textarea id="edit-reply" placeholder="请输入回复内容"></textarea>
                </div>
                
                <div id="edit-image-content" class="form-row" style="display: none;">
                    <label for="edit-reply-image-path">选择图片:</label>
                    <div class="image-selector">
                        <input type="text" id="edit-reply-image-path" placeholder="请选择图片文件" readonly>
                        <button type="button" class="btn-secondary" onclick="openImageBrowser('edit')">
                            <i class="bi bi-folder2-open"></i> 选择图片
                        </button>
                    </div>
                    <div id="edit-image-preview" class="image-preview" style="display: none;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="saveEditRule()">
                    <i class="bi bi-check-lg"></i> 保存
                </button>
                <button class="btn-secondary" onclick="closeEditModal()">
                    <i class="bi bi-x"></i> 取消
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>